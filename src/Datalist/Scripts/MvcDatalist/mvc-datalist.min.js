/*!
 * Datalist 5.0.0
 * https://github.com/NonFactors/MVC5.Datalist
 *
 * Copyright Â© NonFactors
 *
 * Licensed under the terms of the MIT License
 * http://www.opensource.org/licenses/mit-license.php
 */
var MvcDatalistFilter=function(){function n(n){this.page=n.attr("data-page");this.rows=n.attr("data-rows");this.sort=n.attr("data-sort");this.order=n.attr("data-order");this.search=n.attr("data-search");this.additionalFilters=n.attr("data-filters").split(",").filter(Boolean)}return n.prototype={getQuery:function(n){for(var u,r,t=$.extend({},this,n),f="?search="+encodeURIComponent(t.search)+"&sort="+encodeURIComponent(t.sort)+"&order="+encodeURIComponent(t.order)+"&rows="+encodeURIComponent(t.rows)+"&page="+encodeURIComponent(t.page)+(t.id?"&id="+encodeURIComponent(t.id):""),i=0;i<this.additionalFilters.length;i++)for(u=$('[name="'+this.additionalFilters[i]+'"]'),r=0;r<u.length;r++)f+="&"+encodeURIComponent(this.additionalFilters[i])+"="+encodeURIComponent(u[r].value);return f}},n}(),MvcDatalistDialog=function(){function n(n){this.datalist=n;this.filter=n.filter;this.instance=$("#Datalist");this.pager=this.instance.find("ul");this.table=this.instance.find("table");this.tableHead=this.instance.find("thead");this.tableBody=this.instance.find("tbody");this.error=this.instance.find(".datalist-error");this.search=this.instance.find(".datalist-search");this.loader=this.instance.find(".datalist-loading");this.rows=this.instance.find(".datalist-rows input");this.instance.dialog({classes:{"ui-dialog":"datalist-dialog"},dialogClass:"datalist-dialog",autoOpen:!1,minHeight:210,minWidth:455,width:"auto",modal:!0}).parent().resizable({handles:"w,e",stop:function(){$(this).css("height","auto")}})}return n.prototype={open:function(){this.error.html(this.lang("Error"));this.search.val(this.filter.search);this.search.attr("placeholder",this.lang("Search"));this.rows.val(this.limitTo(this.filter.rows,1,99));this.instance.dialog("option","title",this.datalist.title);this.bind();this.refresh();setTimeout(function(n){var t=n.dialog("open").parent();parseInt(t.css("left"))<0&&t.css("left",0);parseInt(t.css("top"))>100?t.css("top","100px"):parseInt(t.css("top"))<0&&t.css("top",0)},100,this.instance)},close:function(){this.instance.dialog("close")},refresh:function(){var n=this,t;this.error.fadeOut(300);t=setTimeout(function(n){n.loader.fadeIn(300);n.table.fadeOut(300);n.pager.fadeOut(300)},500,n);$.ajax({cache:!1,url:n.datalist.url+n.filter.getQuery(),success:function(i){clearTimeout(t);n.render(i)},error:function(){clearTimeout(t);n.render()}})},render:function(n){this.loader.fadeOut(300);this.tableHead.empty();this.tableBody.empty();this.pager.empty();n?(this.renderHeader(n.Columns),this.renderBody(n.Columns,n.Rows),this.renderFooter(n.FilteredRows),this.table.fadeIn(300),this.pager.fadeIn(300)):this.error.fadeIn(300)},renderHeader:function(n){for(var t=document.createElement("tr"),r=document.createElement("th"),i=0;i<n.length;i++)n[i].Hidden||t.appendChild(this.createHeaderColumn(n[i]));!this.filter.sort&&n.length>0&&(t.children[0].className+=" datalist-"+this.filter.order.toLowerCase());t.appendChild(r);this.tableHead.append(t)},renderBody:function(n,t){var e,u,f,o,r,i;for(t.length==0&&(e=document.createElement("tr"),i=document.createElement("td"),e.appendChild(i),i.setAttribute("colspan",n.length+1),i.innerHTML=this.lang("NoData"),i.className="datalist-empty",this.tableBody.append(e)),u=0;u<t.length;u++){for(f=this.createDataRow(t[u]),o=document.createElement("td"),r=0;r<n.length;r++)n[r].Hidden||(i=document.createElement("td"),i.className=n[r].CssClass||"",i.innerText=t[u][n[r].Key],f.appendChild(i));f.appendChild(o);this.tableBody.append(f)}},renderFooter:function(n){var t=Math.ceil(n/this.filter.rows),r,i;if(t>0){for(r=Math.floor(this.filter.page/5)*5,t>5&&this.filter.page>0&&(this.renderPage("&laquo",0),this.renderPage("&lsaquo;",this.filter.page-1)),i=r;i<t&&i<r+5;i++)this.renderPage(i+1,i);t>5&&this.filter.page<t-1&&(this.renderPage("&rsaquo;",this.filter.page+1),this.renderPage("&raquo;",t-1))}},createDataRow:function(n){var t=this,i=document.createElement("tr");$(i).on("click.datalist",function(){t.datalist.select(n,!0);t.close()});return i},createHeaderColumn:function(n){var i=document.createElement("th"),t,r;i.innerText=n.Header;t=this.filter;r=this;n.CssClass&&(i.className=n.CssClass);t.sort==n.Key&&(i.className+=" datalist-"+t.order.toLowerCase());$(i).on("click.datalist",function(){t.order=t.sort==n.Key?t.order=="Asc"?"Desc":"Asc":"Asc";t.sort=n.Key;r.refresh()});return i},renderPage:function(n,t){var r=document.createElement("span"),u=document.createElement("li"),i;if(u.appendChild(r),r.innerHTML=n,i=this,i.filter.page==t)u.className="active";else $(r).on("click.datalist",function(){i.filter.page=t;i.refresh()});i.pager.append(u)},limitTo:function(n,t,i){return Math.min(Math.max(parseInt(n),t),i)||20},lang:function(n){return $.fn.datalist.lang[n]},bind:function(){var i,t=this,n=this.filter;this.search.off("keyup.datalist").on("keyup.datalist",function(r){if(r.keyCode<112||r.keyCode>126){var u=this;clearTimeout(i);i=setTimeout(function(){n.search=u.value;n.page=0;t.refresh()},500)}});this.rows.spinner({min:1,max:99,change:function(){this.value=t.limitTo(this.value,1,99);n.rows=this.value;n.page=0;t.refresh()}}).off("keyup.datalist").on("keyup.datalist",function(n){n.which==13&&(this.blur(),this.focus())})}},n}(),MvcDatalist=function(){function n(n,t){this.url=n.attr("data-url");this.title=n.attr("data-title");this.filter=new MvcDatalistFilter(n);this.element=n;this.hiddenElement=$("#"+n.attr("data-for"));this.browse=$('.datalist-browse[data-for="'+n.attr("data-for")+'"]');this.dialog=new MvcDatalistDialog(this);this.events={};this.set(t);this.reload(!1);this.cleanUp();this.bind()}return n.prototype={set:function(n){n=n||{};this.events.select=n.select||this.events.select;this.events.filterChange=n.filterChange||this.events.filterChange},reload:function(n){var t=this,i=t.hiddenElement.val();i?$.ajax({url:t.url+t.filter.getQuery({id:i,rows:1}),cache:!1,success:function(i){i.Rows.length>0&&t.select(i.Rows[0],n)}}):t.select(null,n)},select:function(n,t){if(this.events.select){var i=$.Event("select.datalist");if(this.events.select.apply(this,[i,n,t]),i.isDefaultPrevented())return}this.hiddenElement.val(n?n.DatalistIdKey:"");this.element.val(n?n.DatalistAcKey:"");t&&(this.hiddenElement.change(),this.element.change())},cleanUp:function(){this.element.removeAttr("data-filters");this.element.removeAttr("data-search");this.element.removeAttr("data-order");this.element.removeAttr("data-title");this.element.removeAttr("data-page");this.element.removeAttr("data-rows");this.element.removeAttr("data-sort");this.element.removeAttr("data-url")},bind:function(){var n=this,i,t;n.element.autocomplete({source:function(t,i){$.ajax({url:n.url+n.filter.getQuery({search:t.term,rows:20}),success:function(n){i($.map(n.Rows,function(n){return{label:n.DatalistAcKey,value:n.DatalistAcKey,item:n}}))}})},select:function(t,i){n.select(i.item.item,!0);t.preventDefault()},minLength:1,delay:500}).on("keyup.datalist",function(t){t.which!=9&&this.value.length==0&&n.hiddenElement.val()&&n.select(null,!0)});n.browse.on("click.datalist",function(){n.element.is("[readonly]")||n.element.is("[disabled]")||n.dialog.open()});for(i=n.filter.additionalFilters,t=0;t<i.length;t++)$('[name="'+i[t]+'"]').on("change.datalist",function(t){n.events.filterChange&&n.events.filterChange.apply(n,[t]);t.isDefaultPrevented()||n.select(null,!0)})}},n}();$.fn.datalist=function(n){return this.each(function(){$.data(this,"mvc-datalist")?$.data(this,"mvc-datalist").set(n):$.data(this,"mvc-datalist",new MvcDatalist($(this),n))})};$.fn.datalist.lang={Error:"Error while retrieving records",NoData:"No data found",Search:"Search..."};